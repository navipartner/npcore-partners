trigger: none

schedules:
  - cron: "0 1 * * *" #UTC TIME! mm HH DD MM DW
    displayName: 'Daily BCPT container run'
    branches:
      include:
      - master
    always: true

resources:
  repositories:
  - repository: scriptsRepo
    type: git
    name: 'NpCore/NpDevOps'

stages:
  - template: /YAML/ZAL Build Definitions/BCPT.yml@scriptsRepo
    parameters:
      pool:
        name: NP PerfTest
        demands: 
        - docker
        - Agent.OS -equals Windows_NT
      
      containerDefinitions:
        - name: vLatest_CLOUD
          alwaysRun: true

      testTargets:
        - 'current_branch'
        - 'prerelease_latest'
        - 'release_latest'

      appDependencies:
        - id: 992c2309-cca4-43cb-9e41-911f482ec088
          name: NP Retail
          publisher: NaviPartner
        - id: ef12bed6-ad9b-4460-b8ee-be8dc0e6fb6c
          name: NP Retail Performance Toolkit
          publisher: NaviPartner
          nugetPackage: 'NaviPartner.NPRetail'
      
      importRapidStartFiles:
        - 'MINIMAL-NPRWITHBCPT.rapidstart'
      
      compileApps:
        - 'Application'
        - 'Performance Toolkit'

      analyzers: ('AppSourceCop','UICop','CodeCop')
      generatePermissions:
        enabled: true
        alObjectsFolder: $(Build.Repository.LocalPath)/Application/src/
        destinationFileName: /Permissions/NPRETAIL.PermissionSet.al
        objectId: 6014400
        objectName: 'NPR NP RETAIL'
        objectCaption: 'NP Retail'
      outputLogExcludeFilters:
        - (?=^[\w\W]*(AL0432):[\w\W]*)(?!^[\w\W]*AL0432:[\w\W]*(Tag:[\w\W]*))

      runSuiteCodes:
        - 'INITDATA'
        - 'POS1S1'
        - 'POS1S5'
        - 'POS1S10'
        - 'POS2S1'
        - 'POS2S5'
        - 'POS2S10'
        - 'POS3S1'
        - 'POS3S5'
        - 'POS3S10'
        - 'POS4S1'
        - 'POS4S5'
        - 'POS4S10'
        - 'POS5S1'
        - 'POS5S5'
        - 'POS5S10'
        - 'POS6S1'
        - 'POS6S5'
        - 'POS6S10'
        - 'POS7S1'
        - 'POS7S5'
        - 'POS7S10'
        - 'POS8S1'
        - 'POS8S5'
        - 'POS8S10'
        - 'POS9S1'
        - 'POS9S5'
        - 'POS9S10'
        - 'POS10'
        - 'POS11'