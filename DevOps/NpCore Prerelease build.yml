trigger:
  batch: true
  branches:
    include:
    - masters/*

resources:
  repositories:
  - repository: scriptsRepo
    type: git
    name: 'NpCore/NpDevOps'

  - repository: translations
    type: git
    name: 'NpCore/NpCore-Translations'
    ref: 'refs/heads/master'

pool:
  name: NP Core Pipelines
  demands: 
  - docker
  # Now only 2019 is available but in the future it will be every newer version.
  # Then we will probably remove this requirement as it will alwyas TRUE.
  - Agent.OS -equals Windows_NT
  - Agent.OSVersion -equals 10.0.17763

jobs:
- template: YAML/Templates/Job/BuildALApp.yml@scriptsRepo
  parameters:
    containerImageName: mcr.microsoft.com/dynamicsnav:10.0.17763.1397-generic
    artifactURL: https://bcartifacts.azureedge.net/onprem/16.3.14085.14238/w1
    containerName: Build-$(Build.BuildId)
    serverInstanceName: BC
    containerAdminUsername: admin
    containerAdminPassword: P@ssword1
    licenseSecureFileName: 'DEV_BC OP 16.flf'
    scriptsRepo: ScriptsRepo
    translationsTargetRepoName: NpCore-Translations
    translationsRepo: translations
    dependancyPackages:
      - source: 'https://api.nuget.org/v3/index.json;https://pkgs.dev.azure.com/navipartner/_packaging/NprAddIns/nuget/v3/index.json'
        id: NaviPartner.NPRetail.AddIns.BC #CASE SENSITIVE!
      - source: 'https://pkgs.dev.azure.com/navipartner/_packaging/JSDependancies/nuget/v3/index.json'
        id: NaviPartner.Dragonglass.BC
        destinationPath: $(Build.SourcesDirectory)/$(Build.Repository.Name)/src/_ControlAddIns/Dragonglass/Scripts        
    appNuGetSource: 
        source: 'https://pkgs.dev.azure.com/navipartner/_packaging/NpCore/nuget/v3/index.json'
        id: NaviPartner.NPCore.BC160
    versionVariableName: 'LastUsedVerNo'
    versionRevisionSeed: 9000
    nuGetSuffix: Prerelease
    runtimePackage: TRUE