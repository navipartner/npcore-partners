const NaviPartner={View:{}},n$=NaviPartner;n$.initialize=(()=>{const d$=window.dragonglass;n$.Enums={NumpadType:{Decimal:0,Integer:1,Date:2,Text:3}},n$.inherit=function(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e},n$.Framework={Environment:{iOS:function(){return/iPad|iPhone|iPod/.test(navigator.platform)||"MacIntel"===navigator.platform&&navigator.maxTouchPoints>1},Android:function(){return/Android/.test(navigator.userAgent)},WindowsPhone:function(){return/Windows Phone/.test(navigator.userAgent)},Mobile:function(){return n$.Framework.Environment.iOS()||n$.Framework.Environment.Android()||n$.Framework.Environment.WindowsPhone()}}},(()=>{var e,t,n=null,o=0,r={};function i(a){var s,c,l=this,u=!1;l.focusHolder=a,l.previousFocus=n,l.previousReference=void 0,l.id=++o,r[l.id]=l.focusHolder,n=l.focusHolder,Object.defineProperty(l,"push",{value:function(){var e=new i(this.focusHolder);return e.previousReference=this,e}}),Object.defineProperty(l,"pop",{value:function(){return l.focusHolder.focusContext=l.previousReference}}),Object.defineProperty(l,"click",{value:function(){t||n===l.focusHolder||"INPUT"!==l.focusHolder.focusElement.tagName||n$.Framework.Environment.Mobile()||(!function(e){for(var t=o;t>e;)r.hasOwnProperty(t)&&r[t].focusContext.release(),t--}(l.id),l.setFocus())}}),Object.defineProperty(l,"blur",{value:function(){if(u&&!e&&!c&&!t){var n=$(".spa-overlay.dimmed",window.top.document);if(n.length&&"2"===n.css("z-index"))return c=!0,s&&clearInterval(s),void(s=setInterval(function(){"1"===n.css("z-index")&&setTimeout(function(){window.focus(),clearInterval(s),s=0,c=!1,l.setFocus(10)})},250));l.setFocus()}}}),Object.defineProperty(l,"focused",{get:function(){return u},set:function(e){u=e,setTimeout(function(){l.switchEvents(u)})}}),l.focused=!0}function a(){t||(e=!1,n$.Framework.Environment.Mobile()||setTimeout(function(){n&&n.focusElement&&n.focusElement.focus()}))}i.prototype.setFocus=function(t){n$.Framework.Environment.Mobile()||setTimeout(function(){e||this.focusHolder.focusElement.focus()}.bind(this),t||0)},i.prototype.release=function(){this.focused=!1,this.focusHolder.focusContext=this.pop(),delete r[this.id],n=this.previousFocus},i.prototype.switchEvents=function(t){t?(this.focusHolder.focusElement.addEventListener("blur",this.blur),this.focusHolder.focusElement.removeEventListener("click",this.click),e||this.setFocus()):(this.focusHolder.focusElement.removeEventListener("blur",this.blur),this.focusHolder.focusElement.addEventListener("click",this.click),this.focusHolder.focusElement.blur())},n$.Focus={request:function(e){e.focusElement&&e.focusElement instanceof HTMLElement&&(n&&n.focusContext&&(n.focusContext.focused=!1),e.focusContext=e.focusContext?e.focusContext.push():new i(e))},release:function(e){e&&e.focusContext&&(e.focusContext.release(),n&&n.focusContext&&(n.focusContext.focused=!0),e.focusContext=void 0)},pause:function(){n&&(e=!0,n.focusElement.blur())},resume:function(){n&&(e=!1,n&&n.focusContext&&n.focusContext.setFocus(10))},suspend:function(){this.pause(),t=!0},continue:function(){t=!1,this.resume(),"function"==typeof document.focus?document.focus():window.focus()},refocus:function(){window.focus(),n&&n.focusContext&&n.focusContext.setFocus()}},document.addEventListener("focus",a,!0),window.addEventListener("focus",a,!0),window.addEventListener("blur",()=>e=!0)})(),(()=>{function e(e){switch(typeof e){case"undefined":return"undefined";case"function":return"<function>";case"object":return e&&e.__json?(delete e.__json,JSON.stringify(e)):function e(t,n){var o={};for(var r in t)if(t.hasOwnProperty(r)){var i=typeof t[r];"string"!==i&&"number"!==i&&"boolean"!==i&&"undefined"!==i||(o[r]=t[r]),"object"===i&&("Content"===r?$.isEmptyObject(t[r])||(o[r]=t[r]):o[r]=n?"<object>":e(t[r],!0))}return n?o:JSON.stringify(o)}(e);case"number":case"boolean":return e.toString()}return e}n$.Debug={},n$.Debug.Source=function(e){this.name=e},n$.Debug.Source.prototype={alert:function(e,t,n){"boolean"==typeof t&&void 0===n&&(n=t,t=void 0),alert(e),this.log({event:this.name||"window.alert",data:t||e,error:!!n,warning:!n})},warning:function(e,t,n){this.log({event:"JavaScript ["+this.name+"]",data:e,trace:!0,warning:!t,error:!!t&&!n})},dontPanic:function(e,t){d$.reportCriticalError(e instanceof Error?e:Error(e.toString()))},error:function(e,t,n){if(this.dontPanic(e,n),this.warning(e,!0,!t),!t){var o=new Error(e);throw o.fromCode=!0,o}},log:function(t){var n=t.data?e(t.data):"",o=t.event?t.event+(n?": "+n:""):t;o=o.replace(/\\n/g,"\n"),t.warning?console.warn(this.name+": "+o):t.error?console.error(this.name+": "+o):console.info(this.name+": "+o),t.trace&&console.trace()},logJson:function(e){e&&e.data&&(e.data.__json=!0),this.log(e)}},n$.Debug.Framework=new n$.Debug.Source("Framework"),n$.Debug.Event=new n$.Debug.Source("Event"),n$.Debug.BackEnd=new n$.Debug.Source("BackEnd"),n$.Debug.Workflow=new n$.Debug.Source("Workflow"),n$.Debug.Capabilities=new n$.Debug.Source("Capabilities"),n$.Debug.External=new n$.Debug.Source("External")})(),(()=>{var e={events:[],inEvent:null,dimTimeout:0,dimmed:!1,processNextEvent:function(){var t=this.events.pop();n$.Debug.Event.log({event:"Dequeueing next InvokeExtensibilityMethod",data:{event:t.event.name,args:t.args,eventsInQueue:this.events.length}}),setTimeout(function(){t.args&&(t.args.ready=!0,t.args.originalArgs=t.originalArgs),t.event.raise(t.args,t.callback),0===e.events.length&&(e.inEvent=null)})}};n$.Event=function(e,t,n){if("object"==typeof e&&e&&(void 0!==e.skipIfBusy&&(t=e.skipIfBusy),void 0!==e.rejectDuplicate&&(n=e.rejectDuplicate),e=e.name),!e)throw"An attempt was made to instantiate an instance of n$.Event without specifying the event name. Switch the debugger on, and inspect the stack trace.";this.name=e,this.skipIfBusy=!!t,this.rejectDuplicate=void 0===n||!!n,this.isMethod=!1,this.extensibilityMethodName=this.name},n$.Event.prototype.raise=function(t,n){var o=this,r=void 0;if("function"==typeof t&&void 0===n&&(n=t,t=void 0),(!t||!t.ready)&&o.isMethod&&(r=o.processArguments(void 0===t?{}:t),t=[o.name,r]),d$.nav.busy){if(o.skipIfBusy)return void n$.Debug.Event.log({event:"Client is busy, skipping event",data:{event:o.name,args:t}});var i={event:o,args:t,callback:n,originalArgs:r};n$.Debug.Event.log({event:"Queueing InvokeExtensibilityMethod",data:i}),e.events.push(i)}else e.inEvent={event:o,args:t},n$.Debug.Event.log({event:"n$.Event.prototype.raise",data:{event:o.name,args:t}}),"function"==typeof o.filter&&o.filter(t),Microsoft.Dynamics.NAV.InvokeExtensibilityMethod(o.extensibilityMethodName,t||[],!1,function(){n$.Debug.Event.log({event:"Finished executing",data:{event:o.name,args:t}}),n&&setTimeout(n),o.isMethod&&o.callback&&setTimeout(function(){o.callback(t&&t.ready?t.originalArgs:r)}),0===e.events.length?e.inEvent=null:d$.nav.busy||e.processNextEvent()})},n$.Event.Method=function(e,t,n){var o=function(e){return e},r=function(){},i=function(){return!1};"object"==typeof e&&e&&("function"==typeof e.filter&&(r=e.filter),void 0!==e.skipIfBusy&&(t=e.skipIfBusy),void 0!==e.rejectDuplicate&&(n=e.rejectDuplicate),"function"==typeof e.processArguments&&(o=e.processArguments),"function"==typeof e.callback&&(this.callback=e.callback),"function"==typeof e.noSupport&&(i=e.noSupport),e=e.name),this.name=e,this.skipIfBusy=!!t,this.rejectDuplicate=void 0===n||!!n,this.isMethod=!0,this.processArguments=o,this.filter=r,n$.Event.Method.noSupport[e]=i},n$.Event.Method.prototype=new n$.Event("OnInvokeMethod"),n$.Event.Method.noSupport={},n$.Events={Action:new n$.Event({name:"OnAction"}),AbortWorkflow:new n$.Event.Method({name:"AbortWorkflow"}),AbortAllWorkflows:new n$.Event.Method({name:"AbortAllWorkflows"}),BeforeWorkflow:new n$.Event.Method({name:"BeforeWorkflow"})},d$.nav.subscribeBusyChanged(t=>{n$.Debug.Event.log({event:"Client busy state changed",data:t?"Busy":"Idle"}),n$.Capabilities.SetBusy.setBusy(t),t?(e.dimmed=!1,e.dimTimeout=setTimeout(function(){e.dimmed=!0,n$.Window.DimScreen(!0)},2e3)):(clearTimeout(e.dimTimeout),e.dimmed&&n$.Window.DimScreen(!1),e.events.length&&e.processNextEvent())})})(),(()=>{var e,t=[];function n(e){var t=!1;const n=`Unsupported external method called: [${e}].`;var o=Promise.reject(n);return o.catch(()=>{}),function(){return t||(t=!0,n$.Debug.Framework.warning(n)),o}}function o(e,t){Object.defineProperty(e,t,{value:n(t)})}n$.ExternalObject=function(e){e&&"string"==typeof e||n$.Debug.External.error("An attempt was made to register an external object without a name.",!1,!0),Object.defineProperty(this,"name",{value:e})},n$.ExternalObject.prototype.isApplicable=(()=>!1),n$.ExternalObject.prototype.priority=(()=>1e3),n$.ExternalObject.getActual=function(){return e||(t.sort(function(e,t){return e.priority()<t.priority(t)?-1:e.priority()>t.priority(t)?1:0}).forEach(function(t){e||(e=e||t.isApplicable()&&t)}),e=e||new n$.ExternalObject,n$.Debug.External.log(e.name+" is selected as the actual external functionality handler"),e)},n$.ExternalObject.extendPrototype=function(e){if(e)for(var t in e)e.hasOwnProperty(t)&&"function"==typeof e[t]&&o(n$.ExternalObject.prototype,t)},n$.ExternalObject.registerExternalObject=function(n){n instanceof n$.ExternalObject||n$.Debug.External.error("An attempt was made to register an external object that is not an instance of n$.ExternalObject.",!1,!0),n$.Debug.External.log("Registering an external object handler: "+n.name),e=null,t.push(n)},["getCapability","announceCapability"].forEach(function(e){o(n$.ExternalObject.prototype,e)}),n$.ExternalObject.Browser=function(){n$.ExternalObject.call(this,"Plain browser"),Object.defineProperties(this,{announceCapability:{value:()=>Promise.resolve(null)},getCapability:{value:()=>Promise.resolve(!1)}})},n$.inherit(n$.ExternalObject.Browser,n$.ExternalObject),n$.ExternalObject.Browser.prototype.priority=(()=>99),n$.ExternalObject.Browser.prototype.isApplicable=(()=>!0),n$.ExternalObject.registerExternalObject(new n$.ExternalObject.Browser),(()=>{const e=/CefSharp/i.test(navigator.userAgent)&&"object"==typeof CefSharp&&CefSharp;let t;const n=new Promise(e=>t=e);e&&CefSharp.BindObjectAsync("csharpHost").then(()=>{window.top.$cefSharp=csharpHost,t()}),n$.ExternalObject.Chromium=function(){n$.ExternalObject.call(this,"Chromium-based Major Tom"),Object.defineProperties(this,{announceCapability:{value:function(e,t,o){return new Promise(function(r){n.then(()=>{try{csharpHost.announceCapability(e,t,o).then(r)}catch(e){n$.Debug.External.warning("Major Tom does not seem to support the capabilities feature. Please upgrade Major Tom to a new version. Error: "+e),r(e)}})})}},getCapability:{value:function(e){try{return new Promise(t=>{n.then(()=>t(csharpHost.getCapability(e)))})}catch(e){return n$.Debug.External.warning("Major Tom does not seem to support the capabilities feature. Please upgrade Major Tom to a new version. Error: "+e),Promise.resolve(!1)}}},setSecure:{value:function(e){try{csharpHost.setSecure(!!e)}catch(e){n$.Debug.External.warning("Major Tom does not seem to support the SetSecure method. Please upgrade Major Tom to a new version.")}}},invokeProxy:{value:(e,t)=>csharpHost.invokeProxyWithHandle(e,t)},invokeProxyAsync:{value:e=>csharpHost.invokeProxyAsync(e)},advertiseStargatePackages:{value:function(e){try{return csharpHost.advertiseStargatePackages(JSON.stringify(e))}catch(e){return n$.Debug.External.warning("Major Tom does not seem to support the AdvertiseStargatePackages method. Please upgrade Major Tom to a new version."),null}}},appGatewayProtocolResponse:{value:(e,t)=>csharpHost.protocolResponse(e,t)},setBusy:{value:e=>csharpHost.setBusy(e)},registerKeyPress:{value:e=>csharpHost.registerKeyPress(e)},popupActive:{value:e=>csharpHost.popupActive(e)},actionActive:{value:e=>csharpHost.actionActive(e)},navDialogActive:{value:e=>csharpHost.navDialogActive(e)},applyTemplate:{value:e=>csharpHost.applyTemplate(e)}})},n$.inherit(n$.ExternalObject.Chromium,n$.ExternalObject),n$.ExternalObject.Chromium.prototype.priority=(()=>5),n$.ExternalObject.Chromium.prototype.isApplicable=(()=>e),n$.ExternalObject.registerExternalObject(new n$.ExternalObject.Chromium)})()})(),(()=>{n$._invokeFrontEndAsync=function(e){if(e.Content&&e.Content._trace){var t=e.Content._trace.debug_trace;t&&n$.Debug.BackEnd.log("Asynchronous event "+e.Method+" with debug trace "+t)}if(e.Method&&"function"==typeof n$.AsyncRequestHandlers[e.Method]){!n$.AsyncRequestHandlers[e.Method].notrace&&e.Content._trace&&n$.Debug.Workflow.logJson({event:"Trace",data:{method:e.Method,data:e.Content._trace}});try{n$.AsyncRequestHandlers[e.Method](e)}catch(t){throw new Error(`An error has occurred while processing the front-end request ${e.Method}: ${t.message}`)}return!0}return n$.Debug.BackEnd.warning("A request was received from C/AL that cannot be recognized:\n\n"+JSON.stringify(e)),!1},n$.AsyncRequestHandlers={},(()=>{var secureMethod=new n$.Event.Method({name:"SecureMethod"}),debug=new n$.Debug.Source("SecureMethod"),methods={},serverPasswordInvocationRequests={id:0,responses:{}},clientPasswords=[];function evaluateClientPassword(e){d$.popup.numpad({title:"Password required",caption:"This operation is password-protected. Please enter your password to continue.",masked:!0,value:"",type:d$.enums.inputType[n$.Enums.NumpadType.Text]}).then(t=>{null!==t&&(clientPasswords.indexOf(String(t))>=0?e.success():d$.popup.error("The password you provided is not valid. You may not execute this operation."))})}function evaluateServerPassword(e){var t=++serverPasswordInvocationRequests.id;d$.popup.numpad({title:"Password required",caption:"This operation is password-protected. Please enter your password to continue.",masked:!0,value:"",type:d$.enums.inputType[n$.Enums.NumpadType.Text]}).then(n=>{null!==n&&secureMethod.raise({action:"validate",method:e.method,password:String(n),requestId:t},()=>{if(serverPasswordInvocationRequests.responses[t]){var n=serverPasswordInvocationRequests.responses[t];delete serverPasswordInvocationRequests.responses[t],n.status?e.success():n.skipUi||d$.popup.error(n.reason||"The password you provided is not valid. You may not execute this operation.")}else d$.popup.error("The server did not respond to the password validation request.")})})}function evaluateHandler(handler){try{return eval(handler)}catch(e){return function(){alert("Invalid SecureMethod handler implementation. Evaluation failed with error: "+e)}}}function SecureMethodContext(e,t,n){this.invocationContext=t,this.method=e,this.success=function(){n()}}n$.Security=n$.Security||{},n$.Security.evaluateMethod=function(e,t,n){methods[e]?n&&"function"==typeof n?methods[e].handler(new SecureMethodContext(e,t,n)):debug.dontPanic("Secure method ["+e+"] was invoked without a callback function. This is a serious blunder by a developer.",!0):debug.dontPanic("Secure method ["+e+"] was requested, but it was not registered.")},n$.AsyncRequestHandlers.ConfigureSecureMethods=function(e){if(e.Content&&e.Content.methods){var t=e.Content.methods;for(var n in t)if(t.hasOwnProperty(n))switch(methods[n]=t[n],methods[n].type){case 0:methods[n].handler=evaluateHandler(methods[n].handler);break;case 1:methods[n].handler=evaluateClientPassword;break;case 2:methods[n].handler=evaluateServerPassword}}},n$.AsyncRequestHandlers.ConfigureSecureMethodsClientPasswords=function(e){e.Content&&e.Content.passwords&&("string"==typeof e.Content.passwords&&(e.Content.passwords=e.Content.passwords.split(",")),e.Content.passwords instanceof Array&&(clientPasswords=[],e.Content.passwords.forEach(function(e){e&&"string"==typeof e&&clientPasswords.push(e)})))},n$.AsyncRequestHandlers.ValidateSecureMethodPassword=function(e){e.Content&&e.Content.hasOwnProperty("success")&&e.Content.requestId&&"number"==typeof e.Content.requestId&&(serverPasswordInvocationRequests.responses[e.Content.requestId]={status:e.Content.success,reason:e.Content.reason,skipUi:e.Content.skipUi})}})(),n$.AsyncRequestHandlers.PauseWorkflow=function(e){var t=w$.getById(e.WorkflowId,!1);t?t.pause(!0):n$.Debug.Workflow.warning("FrontEndAsync.PauseWorkflow invoked, with no active workflow. Check the back end!")},n$.AsyncRequestHandlers.ProvideContext=function(e){var t=w$.getById(e.WorkflowId,!1);t&&t.name!==e.Content.actionCode&&(t=null),t?e.Content.objectName?n$.Workflow.setContext(e.Content.objectName,e.Context,t):$.extend(t.context,e.Context):n$.Workflow.fail("Context was provided for an unknown workflow ["+e.Content.actionCode+", "+e.WorkflowId+"]. This most likely means that an action codeunit handled the OnBeforeWorkflow event not intended for it, but may indicate an incompletely handled front-end state after a previous failed workflow. You should contact support.")},n$.AsyncRequestHandlers.ProvideContext.immediate=!0,n$.AsyncRequestHandlers.ResumeWorkflow=function(e){var t=w$.getById(e.WorkflowId,!1);t?t._paused&&t.resume(e.Content.actionId):n$.Debug.Workflow.warning("FrontEndAsync.ResumeWorkflow invoked, with no active workflow. Check the back end!")},n$.AsyncRequestHandlers.Workflow=function(e){var t=w$.getById(e.WorkflowId),n=t?t[e.StepName]:void 0;if(!0!==e.Content.explicit){if(t&&n)return t._backEndId&&t._backEndId!==e.BackEndId?(n$.Debug.Workflow.error("Unexpected workflow step invoked. BackEndId mismatch at "+e.WorkflowName+"."+e.StepName+" (stored: "+t._backEndId+", received: "+e.BackEndId+")"),void n$.Events.AbortAllWorkflows.raise([],function(){t._abortWorkflow(),n$.Workflow.abortAll()})):void(t.continueAtStep=n);n$.Debug.Workflow.error("A workflow step "+e.WorkflowName+"."+e.StepName+" was requested, but this "+(t&&!n?"workflow step does not exist in the specified workflow.":"workflow is not currently running."),!0)}else setTimeout(function(){!t&&e.Content.nested||w$.nest(t,e)})},n$.AsyncRequestHandlers.Workflow.immediate=!0,(()=>{function e(e){var t={};for(var n in e)if(e.hasOwnProperty(n))if("object"==typeof e[n]&&e[n]instanceof Number){var o=e[n].valueOf();for(var r in e[n])e[n].hasOwnProperty(r)&&e[n][r]===o&&(t[n]=r)}else t[n]=e[n];return t}n$.AsyncRequestHandlers.WorkflowCallCompleted=function(t){var n=t.Content._trace?{duration:t.Content._trace.durationBefore?{before:t.Content._trace.durationBefore}:{all:t.Content._trace.durationAll,action:t.Content._trace.durationAction,data:t.Content._trace.durationData,overhead:t.Content._trace.durationOverhead},raw:t.Content._trace}:{};t.Success||(n.error={silent:!t.ThrowError,message:t.ErrorMessage});var o=w$.getById(t.WorkflowId,!0);if(o&&(n.workflow={id:o.workflowId,name:o.name,step:t.Content._trace&&t.Content._trace.durationBefore?"OnBeforeWorkflow":o.thisStep&&o.thisStep instanceof n$.Workflow.Task?o.thisStep.name:"",parameters:o.parameters?e(o.parameters):{}}),n$.Debug.Workflow.logJson({event:"WorkflowCallCompleted",data:n}),!t.Success)return n$.Debug.Workflow.warning("C/AL error: "+t.ErrorMessage),t.ThrowError&&t.ErrorMessage&&d$.popup.error({title:"Error",caption:t.ErrorMessage}),void(o&&o.fail(t.ActionId));(o||0!==t.WorkflowId||0!==t.ActionId)&&o.receiveComplete(t.ActionId)},n$.AsyncRequestHandlers.WorkflowCallCompleted.immediate=!0,n$.AsyncRequestHandlers.WorkflowCallCompleted.notrace=!0})()})(),(()=>{var e,t,n=0,o=!1;if(n$.Window={DimScreen:function(r,i,a){if(a)o=!1,n=0,r=!1;else{if(n+=r?1:n>0?-1:0,o===r)return;o=n>0}r?(e&&e[0]&&e[0].parentElement||($("#controlAddIn").prepend(e=$('<div class="np-overlay">')).click(function(){i&&i()}),t={focusElement:e[0]}),e.fadeIn(300),n$.Focus.request(t)):0===n&&(e.fadeOut(300),n$.Focus.release(t))}},window.parent&&($(".content-area-box",window.parent.document).css("padding","0"),window.frameElement)){var r=$("#"+window.frameElement.id,window.parent.document);r.css("min-height",window.top.innerHeight+"px"),r.height(window.top.innerHeight+"px"),$(".ms-core-overlay",window.parent.document).css("overflow","hidden")}})(),(()=>{var workflowId=0,actionId=0,globalContext={};function getNextActionId(){return++actionId}var coordinator=function(){var e,t,n,o,r=[],i=!1,a=0,s=0;function c(e){e&&(a=0,n=0,o=0),s&&(clearTimeout(s),s=0)}function l(){d$.store.getState().popups.length||(c(!0),d$.popup.confirm({caption:'This seems to not be working, you are clicking buttons, but there is no response. While it may be that an operation is taking too long to complete, we suspect something went wrong.<br>If you agree with us, then please click "Yes".<br><br>Do you want us to fix this for you?<br><br>This will make the buttons respond again, but may lose the information of the last action you made including all actions you attempted while the system seemed unresponsive.',title:"The buttons seem unresponsive..."}).then(e=>e&&f()))}function u(){if(c(),i&&r.length){n||(n=Date.now());var e=Date.now();++a>=3?s=setTimeout(l,1e3):((e-o<250||e-n>3e4)&&(s=setTimeout(l,1e4)),o=Date.now())}}function f(){e&&"object"==typeof e&&Object.keys(e).forEach(t=>{const n=e[t];t&&"function"==typeof n.outerPromiseCompletionCallback&&n.outerPromiseCompletionCallback()}),e={},globalContext={},r=[],i=!1,t=!1,!1,c(!0)}return f(),{workflow:{isFailed:function(){return t},abortAll:function(t){if(!t)for(var n in e)if(e.hasOwnProperty(n)){var o=e[n];o instanceof n$.Workflow.Workflow&&o.abandon(),coordinator.workflow.completeOuterWorkflowPromise(o)}f()},fail:function(e){t=!0,n$.Events.AbortAllWorkflows.raise([]),this.abortAll(!0),e&&"string"==typeof e&&n$.Debug.Workflow.error(e)},failWorkflow:function(e){t=!0;var n=this;n$.Events.AbortWorkflow.raise({id:e.workflowId},function(){n.completeWorkflow(e)})},nest:function(e,t){e&&e.pause();const n={Parameters:t.Content.workflowParameters,Content:e&&e.actionContent,_nestingContext:t.Content.workflowContext,_nested:!0};d$.executeKnownWorkflow(t.WorkflowName,n,e)},pause:function(){!0},resume:function(){!1},register:function(t){t.workflowId=++workflowId,e[workflowId]=t},start:function(e,t){e.outerPromiseCompletionCallback=t,setTimeout(function(){function t(){n$.Debug.Workflow.log("Workflow execution completed, looking up next."),e.actionContent.Blocking&&e._undim(),c(!0),i=!1;var n=r.shift();n&&(n$.Debug.Workflow.log({event:"-> Unqueueing workflow",data:{remaining:r.length,name:n.name}}),i=!0,setTimeout(function(){r.length&&u(),n.execute(t)}))}if(n$.Debug.Workflow.log({event:"Starting workflow execution",data:{name:e.name}}),e.actionContent.Blocking&&e.dim(!0),e instanceof w$.Workflow){if(i||r.length)return n$.Debug.Workflow.log({event:"-> Queueing workflow",data:{awaiting:r.length,name:e.name}}),r.push(e),void u();i=!0,setTimeout(function(){e.execute(t)})}})},getById:function(t,n){return e[t]?e[t]:(t&&n&&n$.Debug.Workflow.error("Workflow has been requested by ID "+t+", but that workflow either has completed or was aborted. This is a programming bug, not a user error."),null)},setContext:function(e,t,n){var o;switch(e){case"temp":case"tmp":o=n.temp;break;case"transaction":o=n$.Workflow.transactionTemp;break;case"session":o=n$.Workflow.sessionTemp;break;case"global":o=globalContext;break;default:return void this.fail('Context was provided for unknown or unsupported object "'+e+'".')}o?$.extend(o,t):this.fail('Context was provided for object "", but this object is not available (even though by all means it should be).')},completeOuterWorkflowPromise:function(e){e._completedOuterWorkflowPromise||(e._completedOuterWorkflowPromise=!0,e.outerPromiseCompletionCallback&&"function"==typeof e.outerPromiseCompletionCallback&&e.outerPromiseCompletionCallback())},completeWorkflow:function(n){if(!delete e[n.workflowId])return n$.Debug.Workflow.warning("Complete operation was invoked by workflow ["+n.name+", "+n.workflowId+"] but it is not the current workflow. Stack is being cleared, but back-end code must be checked for errors."),void f();n$.Debug.Workflow.log("Workflow "+n.name+" has completed as a "+(n.nested?"nested":"top-level")+" workflow."),coordinator.workflow.completeOuterWorkflowPromise(n),n.workflowCompletionCallback&&"function"==typeof n.workflowCompletionCallback&&n.workflowCompletionCallback(n),n.nested&&n.parent instanceof w$.Workflow&&n.parent.resume(),(t||!Object.keys(e).length)&&f(),n$.Focus.refocus()}}}}();n$.Workflow={getById:coordinator.workflow.getById,registerKnown:coordinator.workflow.registerKnown,setContext:coordinator.workflow.setContext,abortAll:coordinator.workflow.abortAll,fail:coordinator.workflow.fail,nest:coordinator.workflow.nest,start:coordinator.workflow.start,Workflow:function(e,t,n,o){var r=this;o&&o instanceof w$.Workflow&&(r.parent=o,r.nested=!0),coordinator.workflow.register(r),this.model={},this.context={},this._initOptions(t),this.actionContent=n||{},this.alive=!0,this.name=e.Name,this.state={},this.parameters=t||{},this.thisStep=null,this.running=!1,this.invokeBefore=!!e.RequestContext,this.requestContext={};var i=null;e.Steps.forEach(function(e){var t=new n$.Workflow.Step(e,r);r[e.Label]=t,i&&(i.nextStep=t),r.thisStep||(r.thisStep=t),i=t})},Task:function(){this._proto_execute=this.execute},Callable:function(){},Step:function(e,t){this._queue=[],this.name=e.Label,this.label=e.Label,this.code=e.Code,this.workflow=t},Chain:function(e,t,n){this.step=n,this.workflow=n.workflow,this._queue=[],this._setup(e,t),this._initialize()},Command:function(e,t,n){this.step=n,this.workflow=n.workflow,this._setup(e,t)},Result:function(e,t,n){this.chain=n,this.step=n.step,this.workflow=n.step.workflow,this._setup(e,t)},ActionHandler:function(e){this.button=e,this.workflow=null}},function(){function e(e){e||(e=null),e&&"function"!=typeof e&&n$.Debug.Workflow.error("A front-end Workflow has requested a new response context, but has provided a callback parameter that's not a function.");var t=!1,n=!1,o=!1,r=!1;function i(){o&&n$.Debug.Workflow.error("There was an attempt to process again a front-end workflow that has already been fully processed."),(o=t&&n)&&!r&&e&&e()}var a={receiveComplete:function(){i(n=!0)},receiveCallback:function(){r||i(t=!0)},fail:function(){r=!0}};return Object.defineProperty(a,"failed",{get:function(){return r}}),Object.defineProperty(a,"callbackReceived",{get:function(){return t}}),Object.defineProperty(a,"completeReceived",{get:function(){return n}}),a}function t(e,t){return t=t||0,e.requestContext&&e.requestContext[t]&&"object"==typeof e.requestContext[t]||n$.Debug.Workflow.error("Response context id "+t+" was requested from workflow ["+e.name+"."+e.workflowId+"], but it does not exist."),e.requestContext[t]}n$.Workflow.Workflow.prototype.getEventData=function(e){var t={workflow:this.name,workflowId:this.workflowId};return e&&(t.actionId=e),t},n$.Workflow.Workflow.prototype.fail=function(e){n$.Debug.Workflow.log({event:"Workflow fail requested",data:this.getEventData(e)}),this.alive=!1,t(this,e).fail(),coordinator.workflow.failWorkflow(this)},n$.Workflow.Workflow.prototype.receiveComplete=function(e){t(this,e).receiveComplete()},n$.Workflow.Workflow.prototype.receiveCallback=function(e){n$.Debug.Workflow.log({event:e?"Workflow callback received":"BeforeWorkflow callback received",data:this.getEventData(e)}),t(this,e).receiveCallback()},n$.Workflow.Workflow.prototype._initOptions=function(e){for(var t in e)if(e.hasOwnProperty(t)&&0===t.lastIndexOf("_option_")){var n=t.substring(8);for(var o in e[n]=new Number(e[n]),e[t])e[t].hasOwnProperty(o)&&(e[n][o]=e[t][o]);delete e[t]}},n$.Workflow.Workflow.prototype.invokeBeforeWorkflow=function(t){n$.Debug.Workflow.log({event:"BeforeWorkflow",data:this.name});var n=this;n.requestContext[0]=e(t),n$.Events.BeforeWorkflow.raise({action:this.name,parameters:this.parameters,workflowId:n.workflowId},function(){n.receiveCallback()})},n$.Workflow.Workflow.prototype._undim=function(){this.dimCount&&n$.Window.DimScreen(!1,null,!0),this.dimCount=0},n$.Workflow.Workflow.prototype._stepCompleted=function(e){var t=this;t.thisStep._pauseProcessing||(e._abort?t._abortWorkflow():(t.thisStep=t.continueAtStep||t.thisStep.nextStep,t.continueAtStep&&delete t.continueAtStep,t.thisStep&&(t._paused||setTimeout(function(){t.thisStep.execute()}))),t.thisStep||(t._undim(),coordinator.workflow.completeWorkflow(t)))},n$.Workflow.Workflow.prototype._goto=function(e){var t=this;t.thisStep=e,setTimeout(function(){t._paused||t.thisStep.execute()})},n$.Workflow.Workflow.prototype._abortWorkflow=function(e){var t=this;function n(){e?coordinator.workflow.abortAll(!0):coordinator.workflow.completeWorkflow(t)}t.alive=!1,t._backEndId&&t._responded?n$.Events.AbortWorkflow.raise({id:t.workflowId},n):n(),t._undim()},n$.Workflow.Workflow.prototype._respond=function(t,n,o){"function"==typeof t&&void 0===n&&void 0===o&&(o=t,t=void 0);var r=this;(n=n||{}).data=d$.appendDataStates({}).data,this.getInitialContext&&(n={...this.getInitialContext(),...n}),n={...n,...r.context},r._backEndId&&(n.backEndid=r._backEndId),n.parameters=r.parameters;var i=getNextActionId();r.requestContext[i]=e(o),n$.Events.Action.raise([r.name,t||"",r.workflowId,i,n],function(){r.receiveCallback(i)})},n$.Workflow.Workflow.prototype.abandon=function(){this._abortWorkflow(!0)},n$.Workflow.Workflow.prototype.execute=function(e){if(n$.Debug.Workflow.log("Starting execution of workflow: "+this.name),coordinator.workflow.isFailed())return void n$.Debug.Workflow.warning("-> The workflow engine is in the failed state, aborting execution without any further action.");var t=this;if(!t.alive)return void n$.Debug.Workflow.log("-> This workflow is no longer alive, aborting execution with no further action taken by this instance.");const n=d$.store.getState();function o(){t.workflowCompletionCallback=e,t.thisStep?t.thisStep.execute(function(){t._stepCompleted(t.thisStep)}):t._respond(function(){coordinator.workflow.completeWorkflow(t)})}t.running=!0,this.view={sale:"sale"===n.view.active,payment:"payment"===n.view.active},t.invokeBefore?t.invokeBeforeWorkflow(o):o()},n$.Workflow.Workflow.prototype.pause=function(){this.running?(this._paused=!0,this.nested||coordinator.workflow.pause()):n$.Debug.Workflow.warning("Pause invoked on a workflow that is not running yet, or anymore.")},n$.Workflow.Workflow.prototype.resume=function(e){if(this.running){var n=e&&t(this,e),o=!n||n.callbackReceived;this.nested||coordinator.workflow.resume(),this._paused&&this.thisStep&&(delete this._paused,o&&this.thisStep.execute(),delete this._pausedId)}else n$.Debug.Workflow.warning("Resume invoked on a workflow that is not running yet, or anymore.")},n$.Workflow.Workflow.prototype.dim=function(e){void 0===this.dimCount&&(this.dimCount=0);var t=!!e;n$.Window.DimScreen(t),this.dimCount+=t?1:-1,this.dimCount<0&&(this.dimCount=0)}}(),n$.Workflow.Task.prototype._type="Task",n$.Workflow.Task.prototype._setAbortFlags=function(){this._abort=!0,this.workflow._abort=!0},n$.Workflow.Task.prototype._abortIfStepNotDone=function(e){return this instanceof n$.Workflow.Step&&this._queue.length&&(this._setAbortFlags(),n$.Debug.Workflow.error("A workflow task ["+e+"] has been invoked with other tasks still awaiting execution in workflow step ["+this.name+"]. This task can only be invoked last in a workflow step."),!0)},n$.Workflow.Task.prototype.name="[Task]",n$.Workflow.Task.prototype.execute=function(e){if(coordinator.workflow.isFailed())n$.Debug.Workflow.warning("Workflow engine in a failed state, and step execution is initiated. Aborting all.");else{var t=this;this.workflow._abort?e&&e():this.call(function n(){t.workflow._abort?e&&e():t._queue&&t._queue instanceof Array&&t._queue.length?t._queue.shift().execute(n):e&&e()})}},n$.Workflow.Task.prototype.call=function(e){e()},n$.Workflow.Callable.prototype=new n$.Workflow.Task,n$.Workflow.Callable.prototype._setup=function(e,t){this.name=e,this.callObject={function:this._functions[e],arguments:t}},n$.Workflow.Callable.prototype._continue=function(){return!0},n$.Workflow.Callable.prototype.call=function(e){this._continue()?this.callObject.function.apply(this,[{arguments:this.callObject.arguments,callback:e}]):e(),this instanceof n$.Workflow.Chain&&(this.workflow._lastChain=this)},n$.Workflow.Step.prototype=new n$.Workflow.Task,n$.Workflow.Step.prototype._type="Step",n$.Workflow.Step.prototype._initialize=function(){var me=this;function getProxy(e){return function(){var t=me._commands[e].apply(me,arguments);return me._queue.push(t),t}}me.workflow.temp=me.workflow.temp||{},n$.Workflow.sessionTemp=n$.Workflow.sessionTemp||{},n$.Workflow.transactionTemp=n$.Workflow.transactionTemp||{};const state=d$.store.getState(),dataState=state.data,dataSource=dataState.sources[me.workflow.dataSource],dataSet=dataState.sets[me.workflow.dataSource],localization=state.localization.Actions[me.workflow.name],row=dataSet?dataSet.rows.find(e=>e.position===dataSet.currentPosition):null,dataFunc=(()=>{const e=e=>row&&row.fields?row.fields[e]:null;return e.isEmpty=(()=>!dataSet.rows.length),e})();for(var f in eval("var temp = me.workflow.temp, tmp = temp, data = dataFunc, transaction = n$.Workflow.transactionTemp, session = n$.Workflow.sessionTemp, global = globalContext, context = me.workflow.context, model = me.workflow.model, param = me.workflow.parameters, parameters = param, labels = localization, view = n$.View.viewState;"),this._commands)if(this._commands.hasOwnProperty(f)){this._commands[f].chain=this;var proxy=getProxy(f);proxy&&eval("var "+f+" = proxy;")}try{eval(this.code)}catch(e){this.workflow.abandon(),n$.Debug.Workflow.error("A JavaScript runtime error occurred while executing this workflow step:\n\n"+this.code+"\n\nThe error message is:\n\n"+e)}},n$.Workflow.Step.prototype._respond=function(e,t,n){this._abortIfStepNotDone(t)?n():this.workflow._respond(this.name,e,n)},n$.Workflow.Step.prototype._commands={numpad:function(){return new n$.Workflow.Chain("numpad",arguments,this)},intpad:function(){return new n$.Workflow.Chain("intpad",arguments,this)},datepad:function(){return new n$.Workflow.Chain("datepad",arguments,this)},stringpad:function(){return new n$.Workflow.Chain("stringpad",arguments,this)},passwordpad:function(){return new n$.Workflow.Chain("passwordpad",arguments,this)},confirm:function(){return new n$.Workflow.Chain("confirm",arguments,this)},input:function(){return new n$.Workflow.Chain("input",arguments,this)},password:function(){return new n$.Workflow.Chain("password",arguments,this)},message:function(){return new n$.Workflow.Command("message",arguments,this)},error:function(){return new n$.Workflow.Command("error",arguments,this)},hyperlink:function(){return new n$.Workflow.Command("hyperlink",arguments,this)},respond:function(){return new n$.Workflow.Command("respond",arguments,this)},end:function(){return new n$.Workflow.Command("end",arguments,this)},goto:function(){return new n$.Workflow.Command("goto",arguments,this)},store:function(){return new n$.Workflow.Command("store",arguments,this)},abort:function(){return new n$.Workflow.Command("abort",arguments,this)},dim:function(){return new n$.Workflow.Command("dim",arguments,this)},undim:function(){return new n$.Workflow.Command("undim",arguments,this)}},n$.Workflow.Step.prototype.execute=function(e){var t=this;e||(e=function(){t.workflow._stepCompleted(t)}),this.workflow._abort?e():(this._initialize(),this._proto_execute(e))},n$.Workflow.Chain.prototype=new n$.Workflow.Callable,n$.Workflow.Chain.prototype._proto_call=n$.Workflow.Chain.prototype.call,n$.Workflow.Chain.prototype._initialize=function(){var e=this;this._methods.forEach(function(t){var n;e[t]=(n=t,function(){var t=new n$.Workflow.Result(n,arguments,e);return t._initializers.hasOwnProperty(n)&&t._initializers[n].apply(t),e._queue.push(t),e})})},n$.Workflow.Chain.prototype._continue=function(){return!this._executed||(this.hasOwnProperty("_continueFlag")?this._continueFlag:this.getResult().success)},n$.Workflow.Chain.prototype._type="Chain",n$.Workflow.Chain.prototype._methods=["respond","store","when","then","end","goto","ok","cancel","yes","no","abort","debug","do"],n$.Workflow.Chain.prototype._storeResult=function(e,t){this.workflow.context["$"+this.step.name]||(this.workflow.context["$"+this.step.name]={}),this.workflow.context["$"+this.step.name][e]=t},n$.Workflow.Chain.prototype._functions={_numpad:function(e,t,n){var o=this;(function(r,i,a,s,c){var l="object"==typeof r?r:{};"object"!=typeof r?(void 0===i?i=r:l.title=r,l.caption=i,a&&(l.value=a),s&&(l.notBlank=s)):c=i,l.title=l.title||d$.localization().DialogCaption_Confirmation,n&&(l.masked=!0),l.type=d$.enums.inputType[t||n$.Enums.NumpadType.Decimal],"string"!=typeof c&&(c="numpad"),d$.popup.numpad(l).then(t=>{null!==t&&o._storeResult(c,t),o.getResult=function(){return{success:null!==t,value:t||0,cancel:null===t,ok:null!==t}},e.callback()})}).apply(this,e.arguments)},numpad:function(e){n$.Workflow.Chain.prototype._functions._numpad.call(this,e,n$.Enums.NumpadType.Decimal)},intpad:function(e){n$.Workflow.Chain.prototype._functions._numpad.call(this,e,n$.Enums.NumpadType.Integer)},stringpad:function(e){n$.Workflow.Chain.prototype._functions._numpad.call(this,e,n$.Enums.NumpadType.Text)},passwordpad:function(e){n$.Workflow.Chain.prototype._functions._numpad.call(this,e,n$.Enums.NumpadType.Text,!0)},datepad:function(e){n$.Workflow.Chain.prototype._functions._numpad.call(this,e,n$.Enums.NumpadType.Date)},confirm:function(e){var t=this;(function(n,o,r){var i="object"==typeof n?n:{};"object"!=typeof n?(void 0===o?o=n:i.title=n,i.caption=o):r=o,"string"!=typeof r&&(r="confirm"),d$.popup.confirm(i).then(n=>{var o=!0===n;t._storeResult(r,o),t.getResult=function(){return{success:o,value:o,yes:o,no:!o}},e.callback()})}).apply(this,e.arguments)},input:function(e,t){var n=this;(function(o,r,i,a,s,c){var l="object"==typeof o?o:{};"object"!=typeof o?(void 0===r?r=o:l.title=o,l.caption=r,i&&(l.instruction=i),a&&(l.value=a),s&&(l.notBlank=s)):c=r,t&&(l.masked=t),"string"!=typeof c&&(c="input"),d$.popup.input(l).then(t=>{null!==t&&n._storeResult(c,t),n.getResult=function(){return{success:null!==t,value:t,ok:null!==t,cancel:null===t}},e.callback()})}).apply(this,e.arguments)},password:function(e){n$.Workflow.Chain.prototype._functions.input.call(this,e,!0)},calendar:function(e){var t=this;(function(n,o,r){var i="object"==typeof n?n:{};"object"!=typeof n?(void 0===o?o=n:i.title=n,i.caption=o):r=o,"string"!=typeof r&&(r="calendar"),i.dataSource="BUILTIN_SALELINE",d$.popup.calendarPlusGrid(i).then(n=>{null!==n&&t._storeResult(r,n),t.getResult=function(){return{success:null!==n,value:n,ok:null!==n,cancel:null===n}},e.callback()})}).apply(t,e.arguments)}},n$.Workflow.Chain.prototype.call=function(){this._proto_call.apply(this,arguments),this._executed=!0},n$.Workflow.Chain.prototype.getResult=function(){return{success:!this._executed}},function(){function e(e,t){((n,o)=>{var r="object"==typeof n?n:{};"object"!=typeof n&&(void 0===o?o=n:r.title=n,r.caption=o),t(r).then(()=>"function"==typeof e.callback&&e.callback())}).apply(this,e.arguments)}n$.Workflow.Command.prototype=new n$.Workflow.Callable,n$.Workflow.Command.prototype._type="Command",n$.Workflow.Command.prototype._functions={error:function(t){e.call(this,t,d$.popup.error)},message:function(t){e.call(this,t,d$.popup.message)},menu:function(e){(function(t,n,o,r){void 0===r&&"number"==typeof n&&(r=o,o=n,n=t,t=n$.Menu.prototype.__menus[n].Caption),void 0===n&&(n=t,t=n$.Menu.prototype.__menus[n].Caption),d$.popup.menu({Caption:t,rows:r,columns:o,menu:n}).then(()=>e.callback())}).apply(this,e.arguments)},hyperlink:function(e){e.callback()},respond:function(e){(function(t,n){var o={};void 0!==t&&void 0!==n&&(o[t]=n),this.step._respond(o,"respond",e.callback)}).apply(this,e.arguments)},store:function(e){var t=this;(function(e,n){void 0===n&&t.workflow._lastChain&&(n=t.workflow._lastChain.getResult().value),t.workflow.context[e]=n}).apply(this,e.arguments),e.callback()},end:function(e){e.callback()},goto:function(e){(function(e){if(!(this.workflow[e]instanceof n$.Workflow.Step))throw new Error("Workflow step ["+e+"] was invoked, but that step does not exist.");this.workflow._goto(this.workflow[e])}).apply(this,e.arguments)},set:function(e){e.callback()},abort:function(){this.workflow._abortWorkflow()},dim:function(e){this.workflow.dim(!0),e.callback()},undim:function(e){this.workflow.dim(!1),e.callback()}}}(),n$.Workflow.Result.prototype=new n$.Workflow.Callable,n$.Workflow.Result.prototype._type="Result",n$.Workflow.Result.prototype._functions={respond:function(e){var t=this;(function(n){var o={};n?o[n]=t.chain.getResult().value:o=t.chain.getResult(),t.step._respond(o,"respond",e.callback)}).apply(this,e.arguments)},ok:function(e){this.chain._continueFlag=!!this.chain.getResult().ok,this._applyArgumentFunction(e),e.callback()},cancel:function(e){this.chain._continueFlag=!!this.chain.getResult().cancel,this._applyArgumentFunction(e),e.callback()},yes:function(e){this.chain._continueFlag=!!this.chain.getResult().yes,this._applyArgumentFunction(e),e.callback()},no:function(e){this.chain._continueFlag=!!this.chain.getResult().no,this._applyArgumentFunction(e),e.callback()},store:function(e){var t=this;(function(e){t.workflow.context[e]=t.chain.getResult().value}).apply(this,e.arguments),e.callback()},when:function(e){e.callback()},then:function(e){e.callback()},end:function(){},goto:function(e){(function(e){if(!(this.workflow[e]instanceof n$.Workflow.Step))throw new Error("Workflow step ["+e+"] was invoked, but that step does not exist.");this.workflow._goto(this.workflow[e])}).apply(this,e.arguments)},abort:function(){this.workflow._abortWorkflow()},debug:function(e){e.callback()},do:function(e){(function(e){"function"==typeof e&&e()}).apply(this,e.arguments),e.callback()}},n$.Workflow.Result.prototype._initializers={cancel:function(){this._continue=function(){return!0}},ok:function(){this._continue=function(){return!0}},yes:function(){this._continue=function(){return!0}},no:function(){this._continue=function(){return!0}}},n$.Workflow.Result.prototype._applyArgumentFunction=function(e){if(this.chain._continueFlag&&"function"==typeof e.arguments[0]){var arguments,t=e.arguments[0];(arguments=Array.prototype.slice.call(e.arguments)).splice(0,1),t.apply(this.chain,arguments)}},n$.Workflow.Result.prototype._continue=function(){return this.chain._continue()},n$.Workflow.ActionHandler.Workflow=function(e){n$.Workflow.ActionHandler.call(this,e),this.workflow=new n$.Workflow.Workflow(e.action.Workflow,e.action.Parameters,e.action.Content)},n$.inherit(n$.Workflow.ActionHandler.Workflow,n$.Workflow.ActionHandler),n$.Workflow.ActionHandler.Workflow.prototype.execute=function(e,t){e&&(this.workflow.dataSource=e),this.workflow&&this.workflow instanceof n$.Workflow.Workflow?w$.start(this.workflow,t):n$.Debug.Workflow.error("Action without workflow for: "+this.button.action.Type)},window.w$=n$.Workflow})(),(()=>{var e={};function t(e,t){var n=["name","id","description","external","supported"],o=!1;if(e&&"object"==typeof e)for(var r in e)if(e.hasOwnProperty(r)&&("function"==typeof e[r]&&(o=!0),n.indexOf(r)>=0))return n$.Debug.Capabilities.warning("Descriptor ["+t+"] contains a function definition with an invalid name ["+r+"]"),!1;return o||n$.Debug.Capabilities.log("Descriptor ["+t+"] contains no functions. This is only critical if none of descriptors contains any functions."),o}n$.Capability=function(e,n,o,r){var i;function a(){i||(n$.Debug.Capabilities.warning("Capability ["+e+"] is not supported. No function calls on this capability will be placed during this session."),i=!0)}function s(e,t){var n=[],o=this;this[e]=function(){var t=new Promise((e,t)=>n.push({this:o,arguments:arguments,fulfill:e,reject:t}));return t.catch(()=>{n$.Debug.Capabilities.log(`Just-in-case rejection for ${e}, to prevent uncaught rejection errors.`)}),t},this.ifSupported(()=>{delete o[e],Object.defineProperty(this,e,{value:function(){return t.apply(this,arguments)}}),n.forEach(t=>{var n=this[e].apply(t.this,t.arguments);n&&"function"==typeof n.then?n.then(e=>t.fulfill(e)):t.fulfill(n)})},()=>{delete o[e],Object.defineProperty(this,e,{value:function(){return a(),r.noSupport&&r.noSupport[e]&&"function"==typeof r.noSupport[e]?r.noSupport[e].apply(this,arguments):void 0}}),n.forEach(t=>{a();var n=r.noSupport&&r.noSupport[e]&&"function"==typeof r.noSupport[e]?r.noSupport[e].apply(t.this,t.arguments):void 0;n&&"function"==typeof n.catch?n.catch(e=>t.reject(e)):t.reject(n)})})}if(e&&n&&o&&"string"==typeof e&&"string"==typeof n&&"string"==typeof o||n$.Debug.Capabilities.error("An attempt was made to register a capability without necessary describing information.",!1,!0),r||(r={empty:!0}),r.empty||r&&"object"==typeof r&&(t(r.methods,"methods")||t(r.events,"events"))||n$.Debug.Capabilities.error("An attempt was made to create an instance of a n$.Capability object ["+e+", "+n+"] without providing a valid capability descriptor object. Check the log for details.",!1,!0),Object.defineProperties(this,{name:{value:e},id:{value:n},description:{value:o}}),Object.defineProperty(this,"external",{value:n$.ExternalObject.getActual()}),Object.defineProperty(this,"ifSupported",{value:function(e,t){this.external.getCapability(this.id).then(n=>{n?"function"==typeof e&&e(!0):"function"==typeof t?t():"function"==typeof e&&e(!1)})}}),r&&n$.ExternalObject.extendPrototype(r.methods),r&&r.methods)for(var c in r.methods)r.methods.hasOwnProperty(c)&&"function"==typeof r.methods[c]&&s.call(this,c,r.methods[c]);r&&r.events&&Object.defineProperty(this,"events",{value:r.events})},n$.Capabilities={register:async function(t){t instanceof n$.Capability||n$.Debug.Capabilities.error("An attempt was made to register a capability while passing a non-capability object to the register method.",!1,!0),e.hasOwnProperty(t.id)&&n$.Debug.Capabilities.error("A module has attempted to register a capability ["+t.name+", "+t.id+", "+t.description+"] with an id that has already been registered. The new capability will not be available."),n$.Capabilities.hasOwnProperty(t.name)&&n$.Debug.Capabilities.error("A capability is registered with a non-unique name ["+t.name+"]. A name must be unique, and must not match a property or method of the n$.Capabilities object. The new capability will not be available."),e[t.id]=t,Object.defineProperty(n$.Capabilities,t.name,{get:function(){return t}}),await n$.ExternalObject.getActual().announceCapability(t.name,t.id,t.description)}},window.top._np_capabilities={invoke:function(t,n,o){var r=e[t];if(r)if(r.events)if("function"==typeof r.events[n]){var i;if(o)try{i=JSON.parse(o)}catch(e){return void n$.Debug.Capabilities.error("A front-end capability invocation failed: Invalid parameters string passed. Error: "+e+", parameters string: ["+o,!0)}else i=void 0;i&&(i instanceof Array||(i=[i])),r.events[n].apply(r,i)}else n$.Debug.Capabilities.error("A front-end capability invocation failed: unknown event ["+n+"]",!0);else n$.Debug.Capabilities.error("Front-end capability ["+r.name+"] does not support events.",!0);else n$.Debug.Capabilities.error("A front-end capability invocation failed: unknown capability id ["+t+"]",!0)}};var n=!1;n$.Capabilities.register(new n$.Capability("SecureInput","c87cf4ea-31e8-4493-97d4-c359baa4eab9","Removes input into secure controls, such as password boxes, or password numpads, from logging.",{methods:{setSecure:function(e){n===e||this.external.setSecure(e),n=e}}})),n$.Capabilities.register(new n$.Capability("SetBusy","dd205380-9c2c-4e27-aa90-616a4c9fb494","Enables sharing of Microsoft Dynamics NAV back-end busy state with the host application.",{methods:{setBusy:function(e){this.external.setBusy(e)}},noSupport:{setBusy:function(){return Promise.resolve()}}}))})(),n$.Capabilities.register(new n$.Capability("AdministrativeTemplates","f9049576-59df-4b10-9b2c-24ac0ecad016","Allows configuration of Major Tom functionality using administrative templates.",{methods:{applyTemplate:function(e){this.external.applyTemplate(e)}}})),n$.AsyncRequestHandlers.ApplyAdministrativeTemplates=(e=>{var t=null;switch(e.Content.version){case"1.0":t={version:"1.0",content:[]},e.Content.templates.forEach((e,n)=>{var o={id:e.id,persist:e.persist,strength:e.strength};delete e.id,delete e.persist,delete e.strength,o.policy=e,t.content.push(o)})}t&&n$.Capabilities.AdministrativeTemplates.applyTemplate(JSON.stringify(t))}),(()=>{var e=!1,t={},n=!1,o=new n$.Event.Method({name:"KeyPress"}),r=new n$.Debug.Source("Keyboard");n$.AsyncRequestHandlers.ConfigureKeyboardBindings=function(n){n.Content&&n.Content.bindings&&(e=!0,t=n.Content.bindings,[].slice.call(t).forEach(function(e){n$.Capabilities.KeyboardBindings.registerKeyPress(e)}))},n$.Capabilities.register(new n$.Capability("KeyboardBindings","45179214-e726-4f34-a81c-48677ad3a530","Enables Major Tom to send registered keyboard presses over to JavaScript to pass them onto C/AL.",{methods:{registerKeyPress:function(e){this.external.registerKeyPress(e)},popupActive:function(e){this.external.popupActive(!!e)},actionActive:function(e){this.external.actionActive(!!e)},navDialogActive:function(e){this.external.navDialogActive(!!e)}},events:{keyPressed:function(e){n$.Keyboard.keyPressed(e.key)},escHandled:function(){n=!0}}})),n$.Keyboard={keyPressed:function(n){return e&&-1!==t.indexOf(n)?(r.log("Configured key press: ["+n+"]. Forwarding to NAV."),o.raise({key:n}),!0):(r.log("Unconfigured key press: ["+n+"]. Ignoring."),!1)}};var i={};document.addEventListener("keydown",e=>i[e.which]=!0),document.addEventListener("keyup",function(e){!1===i[e.which]&&27===e.which&&(n$.Keyboard.keyPressed("Esc")&&!n&&e.stopImmediatePropagation(),n=!1),delete i[e.which]}),document.addEventListener("keypress",e=>i[e.which]=!1)})(),(()=>{var e=window.frameElement&&window.frameElement.closest("div.spa-container"),t=window.frameElement&&window.frameElement.closest("div.spa-view");if(e&&t&&t.parentElement===e){var n=e.childElementCount,o=null;[t.ownerDocument.defaultView,t.ownerDocument,t.ownerDocument.body,window,document,document.body].map(function(e){e.addEventListener("keydown",s,!0),e.addEventListener("keyup",a,!0)})}function r(){for(var e=t.nextElementSibling;e&&e.nextElementSibling;)e=e.nextElementSibling;return e}function i(e){var t=r();if(t){var n=t.querySelectorAll("ul.radiobuttoncontrol-edit > li > input"),o=-1;if(n.length)for(var i=0;i<n.length;i++)if(n[i].checked){o=i;break}if(-1!==o)return(o+=e)<0&&(o=n.length-1),o>=n.length&&(o=0),n[o].click(),!0}}function a(e){o&&o.key===e.key&&(e.stopImmediatePropagation(),o.action(),o=null)}function s(t){var a=e.childElementCount===n;if(n$.Capabilities.KeyboardBindings.navDialogActive(!a),"ArrowDown"!==t.key&&40!==t.which)if("ArrowUp"!==t.key&&38!==t.which){var s="Escape"===t.key||27===t.which;if(!a&&s){var c=r();if(c){var l=c.querySelectorAll(".ms-nav-actionbar-container > input[type='button']:not([disabled])");if(l.length||(l=c.querySelectorAll(".ms-nav-actionbar-container > button:not([disabled])")),l.length||(l=c.querySelectorAll(".ms-nav-actionbar-container > div")),l.length||(l=c.querySelectorAll(".ms-nav-navigation .ms-nav-back-container > a")),l.length){for(var u=null,f=l.length;f--;){if("none"!==l[f].ownerDocument.defaultView.getComputedStyle(l[f]).display){u=l[f];break}}u&&(o={key:t.key,action:function(){u.click&&"function"==typeof u.click&&u.click()}},t.stopImmediatePropagation())}}}}else i(-1)&&t.stopImmediatePropagation();else i(1)&&t.stopImmediatePropagation()}})(),(()=>{var e=new n$.Event.Method({name:"ProtocolUIResponse"}),t={},n=new n$.Debug.Source("ProtocolUI");function o(e,t){return e.replace(/n\$\.Framework\.RaiseObjectModelEvent\(/gi,"n$.respond('"+t+"', ")}n$.AsyncRequestHandlers.ShowModel=function(r){if(r.Content){var i=r.Content.modelId||"",a=r.Content.html,s=r.Content.css,c=r.Content.script;a&&(a=o(a,i)),c&&(c=o(c,i)),function(o,r,i,a){var s=0,c=document.createElement("iframe");c.src="javascript:''";var l={modelId:o,closed:!1,close:function(){s&&c.contentWindow.clearInterval(s),l.closed=!0},respond:function(t,o,r){l.closed?n.log("Respond was invoked for a model that was previously closed through the np-behavior-close. Ignoring this event, but this indicates a possible refactoring to be needed in the back-end code."):(o||"number"!=typeof c.contentWindow["Timer_"+r]||(s||(s=c.contentWindow["Timer_"+r]),o=r="n$_timer"),e.raise({modelId:t,sender:o,event:r||(void 0===r?"":r)}))},invokeClose:function(){this.respond(o,"model","close")},respondExplicit:function(e,t){this.respond(o,e,t)}},u="";$("head > script").each(function(e,t){(t.src||"").indexOf("/jquery-")>=0&&(u+=t.outerHTML)});var f="<html><head>"+i+"<style>body{display:flex;align-items:center;justify-content:center;height: 100%;}</style>"+(u||"")+"<script>function $_update(src) { var block = $(src); $('body').append(block); }<\/script><script>$(document).ready(function() { $('div.np-behavior-close').click(function() { n$.close(); }); });<\/script></head><body><div id='controlAddIn'>"+r+"</div>"+a+"</body></html>",p=document.getElementById("controlAddIn");p&&(p.appendChild(c),c.contentWindow.document.open(),c.contentWindow.document.write(f),c.contentWindow.document.close(),c.id="model"+o,t[o]={frame:$("#"+c.id).css({width:"100%",height:"100%",position:"absolute",top:"0",left:"0",margin:"0",padding:"0",border:"0"}),window:c.contentWindow,focusElement:c},n$.Focus.request(t[o]),c.contentWindow.n$=l)}(i,a,s,c)}},n$.AsyncRequestHandlers.UpdateModel=function(e){if(e.Content){var r=e.Content.modelId,i=e.Content.html,a=e.Content.css,s=e.Content.script;if(r){var c=t[r];c?(i&&(i=o(i,r),c.window.$_update(i)),a&&c.window.$_update(a),s&&c.window.$_update(s)):n.error("UpdateModel request was received for model ["+r+"] which was previously closed.")}else n.error("UpdateModel request was received without modelId parameter.")}},n$.AsyncRequestHandlers.CloseModel=function(e){var n=e.Content.modelId||"";if(n){var o=t[n];o.frame.remove(),delete t[n],setTimeout(function(){n$.Focus.release(o),window.focus()})}}})(),(()=>{var e,t={},n=0;function o(e){return t[e]}function r(e){return t[++n]=e,e.handle=n}function i(){n$.Workflow.abortAll(),e||d$.popup.message({title:"Important Information",caption:'<p>So you have reached a point where your web-based POS talks to your local hardware, like printers, credit card readers or such. But you are in a web browser, and web browsers cannot just talk to hardware. Also, you did not configure any hardware yet.</p><p>Don\'t worry, if you install our rich client, such as "Major Tom" for Windows, or NP Retail for iOS app, all local hardware functionality will be available to you.</p>'}),e=!0}var a={device:new n$.Debug.Source("Device"),stargate:new n$.Debug.Source("Stargate")},s=new n$.Event.Method({name:"InvokeDeviceResponse"}),c=new n$.Event.Method({name:"Protocol",processArguments:function(e){if("number"==typeof e.contextHandle){var t=o(e.contextHandle);t&&"object"==typeof t&&(e.action=t.action,e.step=t.step)}return e},callback:function(e){var n;e.closeProtocol&&(n=e.contextHandle,t.hasOwnProperty(n)&&delete t[n]),n$.Focus.refocus()}});n$.Events.Protocol={raise:e=>{var t=o(e.contextHandle);if(t&&t.v3)return t.protocolCallback?void t.protocolCallback(e,(e,t)=>n$.Capabilities.Stargate.protocolResponse(e,t)):void a.device.error("Protocol response received from Major Tom without a protocol callback.");c.raise(e)}},n$.Capabilities.register(new n$.Capability("Stargate","cc41bfc6-e151-420f-bb96-a30bb4b0b3b6","Enables integration with local hardware devices, such as bluetooth, printers, credit card readers, and similar. This integration is necessaryto support specific processes, and requires you to use a host application, such as Major Tom, iOS app, or similar. Stargate does not work inbrowser-only scenarios.",{methods:{invokeProxy:function(e,t){var n=this.external.invokeProxy(e,t);return n.then(()=>n$.Focus.refocus()),n},invokeProxyAsync:function(e){this.external.invokeProxyAsync(e),n$.Focus.refocus()},advertise:function(e){return this.external.advertiseStargatePackages(e)},protocolResponse:function(e,t){this.external.appGatewayProtocolResponse(e,t)}},noSupport:{invokeProxy:function(){return i(),Promise.reject(new Error("Unsupported front-end method: invokeProxy"))},invokeProxyAsync:function(){return i(),null},advertise:function(){return Promise.resolve(!1)},protocolResponse:function(){return i(),Promise.reject(new Error("Unsupported front-end method: protocolResponse"))}}}));var l=0;n$.AsyncRequestHandlers.InvokeDevice=function(e){var t=++l,n=e.Content&&e.Content.Method?"Method: "+e.Content.Method:"",o=(n?n+", ":"")+(e.Content.TypeName?"TypeName "+e.Content.TypeName:"");o&&(o=" ("+o+")");var i=" ["+(e.Content&&e.Content.Async?"a":"")+"synchronous]";function c(){a.device.log("InvokeDevice request completed ("+t+")"+o,e)}if(a.device.log("InvokeDevice request received ("+t+i+")"+o,e),e.Content&&e.Content.Async)return n$.Capabilities.Stargate.invokeProxyAsync(e.Envelope),void c();if(e.Content&&e.v3){var u={stargate:"3.0",id:e.Id,success:!1,response:"Proxy not installed"};n$.Capabilities.Stargate.invokeProxy(e.Envelope,r({id:e.Id,action:u.action,step:u.step,v3:!0,protocolCallback:e.protocolCallback})).then(t=>{if(null===t)return a.device.log("Null response received from proxy. Nothing will be sent back to C/AL"),c(),void e.completionCallback(null);u.success=!0,u.response=t,c(),e.completionCallback(u)}).catch(t=>{u.response=t&&t.message||"<unknown error>",a.device.warning("Device invocation failed: "+u.response,!0),c(),e.completionCallback(u)})}else{u={stargate:"2.0",id:e.Id,success:!1,action:e.Content.Action,step:e.Content.Step,response:"Proxy not installed."};n$.Capabilities.Stargate.invokeProxy(e.Envelope,r({id:e.Id,action:u.action,step:u.step})).then(e=>{if(null==e)return a.device.log("Null response received from proxy. Nothing will be sent back to C/AL"),void c();u.success=!0,u.response=e,c(),s.raise(u)}).catch(e=>{u.response=e&&e.message||"<unknown error>",a.device.warning("Device invocation failed: "+u.response,!0),c(),s.raise(u)})}},n$.AsyncRequestHandlers.StargatePackages=function(e){a.stargate.log("StargatePackages request received",e),n$.Capabilities.Stargate.advertise(e.Content).then(e=>{e&&d$.popup.error({title:"Important Information",caption:"<p>There are new version(s) available for some of front-end functionality which you already used during this session. If you continue this session, you may encounter unexpected issues. We recommend that you close your application, and then start it again, to allow the updated features to refresh your client.</p>"})}).catch(e=>{a.stargate.warning("Stargate method invocation failed with message: "+e)})},n$.AsyncRequestHandlers.AppGatewayProtocolResponse=function(e){a.device.log("AppGatewayProtocolResponse request received",e),n$.Capabilities.Stargate.protocolResponse(e.Event,e.Data)}})(),d$.completeTranscendenceInitialization()}),window.top.window.$_np_retail_version||(window.top.NaviPartner=n$),window.top.NaviPartnerTranscendence=n$,window.top.npretail={focus:function(e){window.focus(),e&&n$.Focus&&n$.Focus.refocus&&n$.Focus.refocus()}};