The Application folder contains the source code of NP Retail, NP Attraction and our ecommerce integrations for Shopify and Magento. There's also various smaller modules that supports these three main products.  
All of it is compiled into one Microsoft Business Central ISV .app

## Build
If you are working in a dev environment running a newer BC version than BC17, temporarily increase the app.json versions to match your dev environment in both Application & Test apps.
(remember, for app.json, "runtime"= {bc_version} minus 11, so BC27.0 = runtime 16.0 and baseapp dependency does NOT have to be declared in "dependencies" as it's implicit via "platform" and "application")
Use the /bcdev claude skill to download symbols, compile, publish and run tests.  
Use the -suppressWarnings flag when compiling unless directed to show warnings.



## Info
- We have our own API module in Application/src/_API and Application/src/_API_SERVICES which we use to expose modern REST apis instead of odata pages/codeunits.  
The fern folder in the repo root contains the Fern .yml API documentation for all our .al endpoints.  
- We have a big control addin that runs our react based POS frontend, communicating with .al via Application/src/POS Core/POSDragonglass.Page.al
- Our tests are in a separate BC .app in the repo root /Test/app.json.
- Our app.json files at Application/app.json and Test/app.json are always configured to our oldest supported BC version.
Currently this is BC17.
Our PR pipelines will loop through versions from BC17 up to the latest BC SaaS version to ensure compatibility across versions. For the few areas where we need to write version specific code we use compiler preprocessor symbols.
- Our app contains a Sentry.io telemetry integration which we use instead of BCs application insights.  
When troubleshooting performance, you can narrow down what exactly is taking time by using codeunits:  
Application/src/Sentry/_public/Sentry.Codeunit.al  
Application/src/Sentry/_public/SentrySpan.Codeunit.al  
to create a span around the interesting piece of code.  
For errors, you can log them to Sentry via Sentry.AddLastErrorIfProgrammingBug(). This function is important because AL has the flaw that it mixes together not-a-bug translated user mistakes with actually-bug errors and we only want to log the latter in Sentry, in english. The function tries to distinguish by parsing the english error text.

## Rules
- Do not commit any app.json changes as our pipeline manages this file for the final artifacts.
- Put all plan .md files generated by an LLM during development into .plans/yyyy-mm-dd-username-plan-headline.md for better traceability of past LLM-assisted changes via git blame.
- We limit public object and procedures as much as possible, putting public objects inside a _public folder inside their module folder to make sure we know the developer truly intended his objects to be public rather than just forgetting to set Access = Internal;
- Always remember to update the fern .yml api specification when changing the .al APIs
- All changes must be compatible with BC SaaS (app.json "target": "Cloud") - we no longer support OnPrem for BC versions higher than BC20.
- For new big features/modules without existing test libraries & code in place, design the application code with injection of interfaces implementation mocks in mind at the top level, allowing the test code to implement mocks that read from temporary records and write into temporary records, skipping the database completely. This means passing records around by reference in all internal functions so the temporary records are kept intact.
- Never log API request/response bodies such as JSON/XML to blob/media fields as this is very slow in BC SaaS and our API module already logs all request/responses & metadata in cloudflare (our proxy around BC) & sentry.
- If you need to log an error of the exception kind (="If this happened there's a bug and a developer needs to know about it"), use our sentry codeunit and make sure the error message is written in non-translated english with "This is a programming bug" at the end of the message.
- Use the /al-id-manager claude skill to get next id when you create new objects, new table/tableextension fields and new enum/enumextension values.
