# fern/apis/default/definition/memberships/service-points.yml

imports:
  globalApiTypes: ./../global-api-types.yml
  simpleMemberTypes: ./types/types-simple.yml
  pointTypes: ./types/types-points.yml

service:
  display-name: Membership Points
  auth: true
  base-path: /membership/{membershipId}/points

  path-parameters:
    membershipId: simpleMemberTypes.MembershipId

  endpoints:
    getPointsBalance:
      display-name: Get Points Balance
      docs: Retrieves the current loyalty point balance for a specific membership.
      method: GET
      path: ""
      response: pointTypes.PointsBalance
      availability: in-development
      examples:
        - name: "Get current points"
          path-parameters:
            tenant: $globalApiTypes.tenant.Exampletenant
            environment: $globalApiTypes.environment.ExampleenvironmentProduction
            company: $globalApiTypes.Company.ExampleCompanyCronus
            membershipId: $simpleMemberTypes.MembershipId.ExampleMembershipId
          response:
            body: $pointTypes.PointsBalance.ExamplePointsBalance

    authorizePoints:
      display-name: Authorize Points Transaction
      docs: Creates an authorization for a points withdrawal or deposit. This reserves the points for a specified period and must be finalized.
      method: POST
      path: /reserve
      request: pointTypes.AuthorizePointsRequest
      response: pointTypes.AuthorizePointsResponse
      availability: in-development
      examples:
        - name: "Authorize a point deduction"
          path-parameters:
            tenant: $globalApiTypes.tenant.Exampletenant
            environment: $globalApiTypes.environment.ExampleenvironmentProduction
            company: $globalApiTypes.Company.ExampleCompanyCronus
            membershipId: $simpleMemberTypes.MembershipId.ExampleMembershipId
          request: $pointTypes.AuthorizePointsRequest.ExampleAuthorizePointsRequest
          response:
            body: $pointTypes.AuthorizePointsResponse.ExampleAuthPointsResponse

    cancelAuthorizationPoints:
      display-name: Cancel Point authorization
      docs: Cancels a pending point reservation. Only possible before it has been finalized.
      method: DELETE
      path: /reserve
      request: pointTypes.CancelAuthorizationRequest
      response: pointTypes.CancelPointsResponse
      availability: in-development
      examples:
        - name: "Cancel a point reservation"
          path-parameters:
            tenant: $globalApiTypes.tenant.Exampletenant
            environment: $globalApiTypes.environment.ExampleenvironmentProduction
            company: $globalApiTypes.Company.ExampleCompanyCronus
            membershipId: $simpleMemberTypes.MembershipId.ExampleMembershipId
          request: $pointTypes.CancelAuthorizationRequest.ExampleCancelAuthorizationRequest
          response:
            body: $pointTypes.CancelPointsResponse.ExampleCancelPointsResponse

    # finalizePoints:
    #   display-name: Finalize Points Transaction
    #   docs: Finalizes an authorized points transaction using the transaction ID.
    #   method: POST
    #   path: /finalize
    #   request: pointTypes.FinalizePointsRequest
    #   response: pointTypes.FinalizePointsResponse
    #   availability: in-development
    #   examples:
    #     - name: "Finalizes a point transaction"
    #       path-parameters:
    #         tenant: $globalApiTypes.tenant.Exampletenant
    #         environment: $globalApiTypes.environment.ExampleenvironmentProduction
    #         company: $globalApiTypes.Company.ExampleCompanyCronus
    #         membershipId: $simpleMemberTypes.MembershipId.ExampleMembershipId
    #       request: $pointTypes.FinalizePointsRequest.ExampleFinalizePointsRequest
    #       response:
    #         body: $pointTypes.FinalizePointsResponse.ExampleFinalizePointsResponse

    registerSale:
      display-name: Register Sale
      docs: Registers a sale, with points being added to membership based on the contents of it. Reservations on the membership can be finalized.
      method: POST
      path: ''
      request: pointTypes.RegisterSaleRequest
      response: pointTypes.RegisterSaleResponse
      availability: in-development
      examples:
        - name: "Register a sale"
          path-parameters:
            tenant: $globalApiTypes.tenant.Exampletenant
            environment: $globalApiTypes.environment.ExampleenvironmentProduction
            company: $globalApiTypes.Company.ExampleCompanyCronus
            membershipId: $simpleMemberTypes.MembershipId.ExampleMembershipId
          request: $pointTypes.RegisterSaleRequest.ExampleRegisterSale
          response: 
            body: $pointTypes.RegisterSaleResponse.ExampleRegisterSaleResponse

    getPointsTransactions:
      display-name: Get Points Transactions
      docs: Retrieves the points transaction ledger entries for a membership with pagination. Supports filtering by entry type and date.
      method: GET
      path: /transactions
      request:
        name: getPointsTransactionsRequest
        query-parameters:
          entryType:
            type: optional<string>
            docs: Filter by entry type (e.g., "Sale", "Refund", "Withdrawal", "Deposit").
          date:
            type: optional<string>
            docs: Filter by posting date. Supports BC filter syntax (e.g., "2025-01-01..2025-12-31").
          pageSize: optional<integer>
          pageKey: optional<string>
      response: pointTypes.PaginatedPointsTransactions
      availability: in-development
      examples:
        - name: "Get points transactions"
          path-parameters:
            tenant: $globalApiTypes.tenant.Exampletenant
            environment: $globalApiTypes.environment.ExampleenvironmentProduction
            company: $globalApiTypes.Company.ExampleCompanyCronus
            membershipId: $simpleMemberTypes.MembershipId.ExampleMembershipId
          query-parameters:
            entryType: "Sale"
            pageSize: 50
          response:
            body: $pointTypes.PaginatedPointsTransactions.ExamplePaginatedPointsTransactions

    getReceiptList:
      display-name: Get Points Sale History
      docs: Retrieves the transaction history for a membership's loyalty points.
      method: GET
      path: /receiptList
      response: pointTypes.PointsSaleHistoryResponse
      availability: in-development
      examples:
        - name: "Get points sale history"
          path-parameters:
            tenant: $globalApiTypes.tenant.Exampletenant
            environment: $globalApiTypes.environment.ExampleenvironmentProduction
            company: $globalApiTypes.Company.ExampleCompanyCronus
            membershipId: $simpleMemberTypes.MembershipId.ExampleMembershipId
          response:
            body: $pointTypes.PointsSaleHistoryResponse.ExampleSalePointsHistory

    # getPointsHistory:
    #   display-name: Get Points History
    #   docs: Retrieves the transaction history for a membership's loyalty points.
    #   method: GET
    #   path: /history
    #   response: pointTypes.PointsHistoryResponse
    #   availability: in-development
    #   examples:
    #     - name: "Get points history"
    #       path-parameters:
    #         tenant: $globalApiTypes.tenant.Exampletenant
    #         environment: $globalApiTypes.environment.ExampleenvironmentProduction
    #         company: $globalApiTypes.Company.ExampleCompanyCronus
    #         membershipId: $simpleMemberTypes.MembershipId.ExampleMembershipId
    #       response:
    #         body: $pointTypes.PointsHistoryResponse.ExamplePointsHistory
