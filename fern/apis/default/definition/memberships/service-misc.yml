# yaml-language-server: $schema=https://raw.githubusercontent.com/fern-api/fern/main/fern.schema.json

imports:
  globalApiTypes: ./../global-api-types.yml
  simpleTypes: ./types/types-simple.yml
  compositeTypes: ./types/types-composite.yml
  pointTypes: ./types/types-points.yml

service:
  display-name: Miscellaneous
  auth: true
  base-path: /membership

  endpoints:

    getLoyaltyTags:
      docs: Retrieves all loyalty tag definitions available in the system
      display-name: Get Loyalty Tags
      method: GET
      path: /loyaltytags
      response: GetLoyaltyTagsResponse
      examples:
        - name: Get all loyalty tags
          path-parameters:
            tenant: $globalApiTypes.tenant.Exampletenant
            environment: $globalApiTypes.environment.ExampleenvironmentProduction
            company: $globalApiTypes.Company.ExampleCompanyCronus
          response:
            body: $GetLoyaltyTagsResponse.ExampleGetLoyaltyTags

    createLoyaltyTags:
      docs: Creates one or more loyalty tag definitions that can be used to tag point entries
      display-name: Create Loyalty Tags
      method: POST
      path: /loyaltytags
      request: CreateLoyaltyTagsRequest
      response: CreateLoyaltyTagsResponse
      examples:
        - name: Create multiple loyalty tags
          path-parameters:
            tenant: $globalApiTypes.tenant.Exampletenant
            environment: $globalApiTypes.environment.ExampleenvironmentProduction
            company: $globalApiTypes.Company.ExampleCompanyCronus
          request: $CreateLoyaltyTagsRequest.ExampleCreateLoyaltyTags
          response:
            body: $CreateLoyaltyTagsResponse.ExampleCreateLoyaltyTags

    resolveIdentifier:
      docs: Resolves number as a specific membership, member, or card
      display-name: Resolve Member Identifier
      method: GET
      path: /resolveIdentifier
      request:
        name: resolveMemberIdentifier
        query-parameters:
          identifier: string
      response: ResolveMemberIdentifierResponse
      examples:
        - name: Card Number
          path-parameters:
            tenant: $globalApiTypes.tenant.Exampletenant
            environment: $globalApiTypes.environment.ExampleenvironmentProduction
            company: $globalApiTypes.Company.ExampleCompanyCronus
          query-parameters:
            identifier: $simpleTypes.CardNumber.ExampleCardNumber
          response:
            body: $ResolveMemberIdentifierResponse.ExampleCardNumber
        - name: Member Number
          path-parameters:
            tenant: $globalApiTypes.tenant.Exampletenant
            environment: $globalApiTypes.environment.ExampleenvironmentProduction
            company: $globalApiTypes.Company.ExampleCompanyCronus
          query-parameters:
            identifier: $simpleTypes.MemberNumber.ExampleMemberNumber
          response:
            body: $ResolveMemberIdentifierResponse.ExampleMemberNumber
        - name: Membership Number
          path-parameters:
            tenant: $globalApiTypes.tenant.Exampletenant
            environment: $globalApiTypes.environment.ExampleenvironmentProduction
            company: $globalApiTypes.Company.ExampleCompanyCronus
          query-parameters:
            identifier: $simpleTypes.MembershipNumber.ExampleMembershipNumber
          response:
            body: $ResolveMemberIdentifierResponse.ExampleMembershipNumber

    # LISTS and REPORTS
    listMemberships:
      docs: 
        Retrieve a list of memberships.
        This endpoint supports pagination and filtering. 
        Page size default is 100, maximum is 1000.
      display-name: List Memberships
      method: GET
      path: /list
      request:
        name: List Memberships
        query-parameters:
          pageSize: optional<integer>
          pageKey: optional<string>
          communityCode: optional<string>
          membershipCode: optional<string>
          customerNumber: optional<string>
          blocked: optional<boolean>
          issueDate: optional<datetime>
          issuedFromDate: optional<datetime>
          issuedUntilDate: optional<datetime>
      response: compositeTypes.PaginatedMembershipsDTO
      examples:
        - path-parameters:
            tenant: $globalApiTypes.tenant.Exampletenant
            environment: $globalApiTypes.environment.ExampleenvironmentProduction
            company: $globalApiTypes.Company.ExampleCompanyCronus
          query-parameters:
            pageSize: 1
            membershipCode: $simpleTypes.MembershipCode.GOLD
          response:
            body: $compositeTypes.PaginatedMembershipsDTO.ExamplePaginatedMemberships


    # generateNotificationToken:
    #   docs: Generate a notification token for a member
    #   display-name: Generate Notification Token
    #   method: POST
    #   path: /member/{memberId}/notification-token
    #   path-parameters:
    #     memberId: simpleTypes.MemberId
    #   request:
    #     name: generateNotificationToken

    # expireNotificationToken:
    #   docs: Expire a notification token
    #   display-name: Expire Notification Token
    #   method: POST
    #   path: /member/{memberId}/notification-token/expire
    #   path-parameters:
    #     memberId: simpleTypes.MemberId
    #   request:
    #     name: expireNotificationToken

    # validateNotificationToken:
    #   docs: Validate a notification token
    #   display-name: Validate Notification Token
    #   method: POST
    #   path: /notification-token/validate
    #   request:
    #     name: validateNotificationToken

    # memberEmailExists:
    #   docs: Check if a member's email exists
    #   display-name: Check Member Email Exists
    #   method: POST
    #   path: /member/email-exists
    #   request:
    #     name: memberEmailExists

    # getMembershipRoles:
    #   docs: Retrieve roles associated with a membership
    #   display-name: Get Membership Roles
    #   method: GET
    #   path: /membership/{membershipId}/roles
    #   path-parameters:
    #     membershipId: simpleTypes.MembershipId
    #   request:
    #     name: getMembershipRoles

    # getMembershipTicketList:
    #   docs: Retrieve a list of tickets associated with a membership
    #   display-name: Get Membership Tickets
    #   method: GET
    #   path: /membership/{membershipId}/tickets
    #   path-parameters:
    #     membershipId: simpleTypes.MembershipId
    #   request:
    #     name: getMembershipTicketList

    # changeMembershipValidation:
    #   docs: "**** Validate a change to a membership"
    #   display-name: Validate Membership Change
    #   method: POST
    #   path: /membership/{membershipId}/validate-change
    #   path-parameters:
    #     membershipId: simpleTypes.MembershipId
    #   request:
    #     name: membershipValidation


types:

  LoyaltyTagDefinition:
    docs: Defines a loyalty tag that can be attached to point entries
    properties:
      key:
        type: string
        docs: Unique identifier for the tag (e.g., "SALES-CHANNEL", "REF-NO")
      description:
        type: string
        docs: Human-readable description of what this tag represents
    examples:
      - name: ExampleSalesChannelTag
        value:
          key: "SALES-CHANNEL"
          description: "Identifies the sales channel where the transaction occurred"
      - name: ExampleRefNoTag
        value:
          key: "REF-NO"
          description: "External reference number for tracking"
      - name: ExampleCampaignTag
        value:
          key: "CAMPAIGN"
          description: "Campaign identifier for promotional tracking"

  GetLoyaltyTagsResponse:
    docs: Response containing all available loyalty tag definitions
    properties:
      tags:
        type: list<LoyaltyTagDefinition>
        docs: List of all loyalty tag definitions in the system
    examples:
      - name: ExampleGetLoyaltyTags
        value:
          tags:
            - key: "SALES-CHANNEL"
              description: "Identifies the sales channel where the transaction occurred"
            - key: "REF-NO"
              description: "External reference number for tracking"
            - key: "CAMPAIGN"
              description: "Campaign identifier for promotional tracking"

  CreateLoyaltyTagsRequest:
    docs: Request to create one or more loyalty tag definitions
    properties:
      tags:
        type: list<LoyaltyTagDefinition>
        docs: List of loyalty tags to create. Each tag key must be unique.
    examples:
      - name: ExampleCreateLoyaltyTags
        value:
          tags:
            - key: "SALES-CHANNEL"
              description: "Identifies the sales channel where the transaction occurred"
            - key: "REF-NO"
              description: "External reference number for tracking"

  CreateLoyaltyTagsResponse:
    docs: Response after creating loyalty tags
    properties:
      tags:
        type: list<LoyaltyTagDefinition>
        docs: List of successfully created loyalty tags
      createdCount:
        type: integer
        docs: Number of tags that were created
    examples:
      - name: ExampleCreateLoyaltyTags
        value:
          tags:
            - key: "SALES-CHANNEL"
              description: "Identifies the sales channel where the transaction occurred"
            - key: "REF-NO"
              description: "External reference number for tracking"
          createdCount: 2

  IdentifierTypeEnum:
    enum:
      - membership
      - member
      - card
  IdentifierType:
    type: IdentifierTypeEnum
    docs: The type of the identifier that was resolved

  ResolveMemberIdentifierResponse:
    properties:
      type: simpleTypes.IdentifierType
      membershipId: optional<simpleTypes.MembershipId>
      memberId: optional<simpleTypes.MemberId>
      cardId: optional<simpleTypes.CardId>
    examples:
      - name: ExampleCardNumber
        value:
          type: card
          cardId: $simpleTypes.CardId.ExampleCardId
          membershipId: $simpleTypes.MembershipId.ExampleMembershipId
          memberId: $simpleTypes.MemberId.ExampleMemberId
      - name: ExampleMemberNumber
        value:
          type: member
          memberId: $simpleTypes.MemberId.ExampleMemberId
      - name: ExampleMembershipNumber
        value:
          type: membership
          membershipId: $simpleTypes.MembershipId.ExampleMembershipId